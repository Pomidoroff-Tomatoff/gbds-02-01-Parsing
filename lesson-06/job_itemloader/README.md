`GB` BigData / [Олег Гладкий](https://gb.ru/users/3837199) // домашнее задание

`262698` __Методы сбора и обработки данных из сети Интернет__:  `06`. Scrapy: item.py, pipeslines.py и ItemLoader()

# Scrapy: item.py, pipeslines.py
System: Windows 7 x64
Python: 3.8.10
Scrapy: 2.8.0 (разработка на 2.7.1)
Splash: 0.9.0 (разработка на 0.7.2)

## Парсинг сайта


### проект: __job\_itemloader__

    Сайт: hh.ru
    Паук: hh_list_itemloader.py
    Идея: ItemLoader и процессоры в items.py


__ВОПРОС__

Обрабатывать процессорами в `items.py` очень удобно. Но, бывает так, что процессор поля получает сразу несколько значений... 

- Процессоры полей в items.py обрабатывают входящие от паука строки с данными для каждого поля отдельно. А если такая строка содержит данные сразу для нескольких полей? Например, зарплата: "от 1000 до 2000 руб" — это три поля (`salary_min`, `salary_max`, `salary_cur`).

- Важно то, что эту строку с множеством зарплатных данных лучше парсить одной функцией! Потому что стока меняется и лучше всю логику сосредоточить в одном месте. Тогда эта функция вернёт словарь из трёх значений. И как же нам эти три значения распределить по трём полям, а?

Я попытался решить этот вопрос кэшированием: в первом поле модуля `items.py` процессор вызывает функцию с обработкой и записью всех значений в глобальные переменные этого модуля. А возвращает только соответствующее своему полю значение. Следующие процессоры в следующих полях обращаются к соответствующему кэшированному значению и отдают его своему полю. Такое решение похоже на костыль — усложняет программирование... 

Причём я подозреваю, что даже при успешности такого решения я теряю полученные от паука значения: например, я среди полученных вакансий нигде не встретил запись, где бы первое поле `salary_min`, было бы пустым, а остальные поля непустые! А вот при решении при помощи API такая ситуация присутствует: есть записи с пустым минимальным значением и заполненным максимальным (и валютой)... 

ВОПРОС: не встречался ли вам более изящный способ решения для этой ситуации?


2023-03-09